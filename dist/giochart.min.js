!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("lodash"),require("react-dom"),require("G2")):"function"==typeof define&&define.amd?define(["react","lodash","react-dom","G2"],t):"object"==typeof exports?exports.GIO=t(require("react"),require("lodash"),require("react-dom"),require("G2")):e.GIO=t(e.React,e.lodash,e.ReactDOM,e.G2)}(this,function(e,t,r,o){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){r(1),e.exports=r(4)},function(e,t,r){"use strict";var o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=r(2),i=r(3);t.HttpStatus={Ok:200,Created:201,NoContent:204,MovedPermanently:301,SeeOther:303,NotModified:304,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,RequestTimeout:408,UnsupportedEntity:422,Locked:423,TooManyRequests:429,InternalServerError:500,NotImplemented:501};var a=function(e){function r(t){var r=e.call(this,t)||this;return r.state={isLoaded:!1,columns:null,source:null,selected:null},r}return o(r,e),r.prototype.getChildContext=function(){return{columns:this.state.columns,source:this.state.source,selected:this.state.selected}},r.prototype.componentWillReceiveProps=function(e){this.props.params!==e.params&&this.defaultRequest(e.params,this.afterFetch.bind(this))},r.prototype.render=function(){return n.createElement("div",{style:this.props.style},this.props.children)},r.prototype.defaultRequest=function(e,r){var o="http://gta.growingio.dev:18443/v4/projects/"+project.id+"/chartdata",n=new Headers;n.append("authorization","Token 5ac75d524422179e2123f1da5d8c2622e5330dff8173edf90e52fc4f49d63efe");var i=new Request(o,{headers:n});return fetch(i,{credentials:"same-origin",contentType:"application/json",method:"post",body:JSON.stringify(e)}).then(function(e){var r=e.status;if(r===t.HttpStatus.Ok)return e.json()}).then(function(e){return r(e)})},r.prototype.componentDidMount=function(){var e=this.props.params;this.defaultRequest(e,this.afterFetch.bind(this))},r.prototype.afterFetch=function(e){var t=e.meta.columns,r=i.map(e.meta.columns,"id"),o=i.map(e.data,function(e){return i.zipObject(r,e)});this.setState({isLoaded:!0,columns:t,source:o}),this.props.onLoad&&this.props.onLoad(this.state)},r}(n.Component);a.childContextTypes={source:n.PropTypes.any,columns:n.PropTypes.array,selected:n.PropTypes.any,selectHandler:n.PropTypes.func},t.__esModule=!0,t.default=a},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t,r){"use strict";var o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=r(3),i=r(2),a=r(5),s=r(6),c=function(e){var t={combinMetrics:!1,geom:"line",size:2},r={bar:{geom:"interval"},line:{geom:"line"}};return n.merge({},t,r[e])},p=function(e){function t(t){var r=e.call(this)||this;r.selectMode="multiple",r.lastSelectedShape=null;var o=["#fc5f3a","#fa9d1b","#48a1f9","#9ecefe","#349a38","#7fd182","#d5375f","#ff8ba8","#3e4a9c","#8d9bf3","#525566","#a1a4b3","#25ada1","#8ae1d8","#755920","#dab873","#8d49a4","#da97f1","#f5d360","#ffbd9c"],n=s.Util.mix(!0,{},s.Theme,{animate:!1,colors:{default:o,intervalStack:o},defaultColor:"#fc5f3a",shape:{area:{fill:"#fc5f3a"},interval:{fill:"#d5375f"}}});return s.Global.setTheme(n),r}return o(t,e),t.prototype.componentWillReceiveProps=function(e,t){if(t.source){var r=t.source;if(n.isEmpty(t.selected)){if(!n.isEqual(this.context.source,t.source)||!n.isEqual(this.props.chartParams,e.chartParams)){this.chart&&this.chart.destroy();var o=e.chartParams||this.generateChartParams(t.columns);o&&this.drawChart(o,r)}if(this.chart)this.chart.changeData(r);else{var o=e.chartParams||this.generateChartParams(t.columns);o&&this.drawChart(o,r)}}else{var i=n.map(n.filter(e.chartParams.columns,{isDim:!0}),"id"),a=n.filter(t.selected,function(e){return n.isEmpty(n.pick(e,i))});if(n.isEmpty(a))return;var s=n.filter(r,function(e){return n.some(a,function(t){return n.isMatch(e,t)})});n.isEmpty(s)?this.chart.changeData(r):this.chart.changeData(s)}}},t.prototype.generateChartParams=function(e){if(e)return{chartType:this.props.chartType,columns:e,granularities:this.props.granularities}},t.prototype.render=function(){return i.createElement("div",{style:{height:"100%"}})},t.prototype.componentDidMount=function(){var e=this.props,t=e.chartParams,r=e.source;this.props.hasOwnProperty("source")&&(this.chart&&this.chart.destroy(),this.drawChart(t,r))},t.prototype.componentWillUnmount=function(){this.chart&&this.chart.destroy()},t.prototype.drawChart=function(e,t){var r=this,o=document.createElement("div");o.style.height="100%",a.findDOMNode(this).appendChild(o);var i=o.getBoundingClientRect();if(!e.chartType)return void console.error("Error 101: 图表没有指定类型或类型不合法，请访问ChartParams.md获取类型定义的方案");if(0===i.height)return void console.error("Error 103: 绘制图形取决于外框高度,而当前外框的高度为0,如果你已经设置了高度，那可能绘制发生在了样式生效前");var p=new s.Chart({container:o,forceFit:!0,height:i.height,plotCfg:{}}),u=this.buildSourceConfig(e),l=n.map(n.filter(e.columns,{isDim:!1}),"id"),h=n.map(n.filter(e.columns,{isDim:!0}),"id"),d=new s.Frame(t),f=c(e.chartType);if(f.combinMetrics&&l.length){d=s.Frame.combinColumns(d,l,"val","metric",h),h.push("metric");var m=n.fromPairs(n.zip(l,name)),y=d.colArray("metric"),v=y.map(function(e){return m[e]});d.colReplace("metric",v)}p.source(d,u);var g=p[f.geom](e.adjust),P=f.pos?l[0]+"*"+l[1]:s.Stat.summary.sum(h[0]+"*"+l[0]);if(g.position(P),h.length>1&&g.color(h[1]),f.size&&g.size(f.size),this.props.hasOwnProperty("select")&&(g.selected(!0,{selectedMode:"single",style:{fill:"#fe9929"}}),"tm"!==h[0])){var C=f.pos?l.slice(0,2):[h[0]];p.on("plotclick",function(e){return r.selectHandler(e,C)})}p.render(),this.chart=p},t.prototype.selectHandler=function(e,t){var r=e.shape;if(r){var o=e.geom._attrs.selectedCfg.selectedMode;if(r.get("selected")){var i=r.get("origin"),a=n.pick(i._origin,t);"single"===o?(this.props.select(a,this.lastSelectedShape),this.lastSelectedShape=a):this.props.select(a,null)}else{var i=r.get("origin");this.props.select(null,n.pick(i._origin,t))}}},t.prototype.buildSourceConfig=function(e){var t={},r=c(e.chartType);return e.columns.forEach(function(e){t[e.id]={alias:e.name,type:"tm"!==e.id&&e.isDim?"cat":"linear"},e.rate&&(t[e.id].formatter=function(e){return(100*e).toPrecision(3)+"%"})}),t.tm.formatter=function(e){return e>0?"第"+e+"天":"当天"},e.granularities&&e.granularities.forEach(function(e){e.interval&&(t[e.id]={mask:e.interval>=86400?"mm-dd":"HH:mm",nice:!0,type:"line"===r.geom?"time":"timeCat"})}),t},t}(i.Component);p.contextTypes={selected:i.PropTypes.any,source:i.PropTypes.any,columns:i.PropTypes.array},t.__esModule=!0,t.default=p},function(e,t){e.exports=r},function(e,t){e.exports=o}])});