!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("react-dom"),require("lodash"),require("G2")):"function"==typeof define&&define.amd?define(["react","react-dom","lodash","G2"],e):"object"==typeof exports?exports.GrChart=e(require("react"),require("react-dom"),require("lodash"),require("G2")):t.GrChart=e(t.React,t.ReactDOM,t.lodash,t.G2)}(this,function(t,e,r,a){return function(t){function e(a){if(r[a])return r[a].exports;var o=r[a]={exports:{},id:a,loaded:!1};return t[a].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";var a=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),n=r(2),i=r(3),c=r(4),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.componentWillReceiveProps=function(t,e){e.chartData&&(this.chart&&this.chart.destroy(),this.drawChart(t.chartParams,e.chartData))},e.prototype.render=function(){return o.createElement("div",null)},e.prototype.componentDidMount=function(){var t=this.props,e=t.chartParams,r=t.chartData;this.props.hasOwnProperty("chartData")&&(this.chart&&this.chart.destroy(),this.drawChart(e,r))},e.prototype.drawChart=function(t,e){var r=document.createElement("div");n.findDOMNode(this).appendChild(r);var a=new c.Chart({container:r,height:r.getBoundingClientRect().height||250,forceFit:!0,plotCfg:{}}),o=this.createSourceConfig(t,e.meta),p=i.map(e.meta,"id"),s=i.map(e.data,function(t){return i.zipObject(p,t)}),u=new c.Frame(s),l=i.filter(e.meta,{isDim:!1}),m=i.map(l,"id"),h=i.map(i.filter(e.meta,{isDim:!0}),"id");if("bubble"!==t.chartType&&t.metrics.length>1){u=c.Frame.combinColumns(u,m,"val","metric",h),h.push("metric"),m=["val"];var d=i.fromPairs(i.map(l,function(t){return[t.id,t.name]})),f=u.colArray("metric"),y=f.map(function(t){return d[t]});u.colReplace("metric",y)}a.source(u,o),a.axis("tm",{title:!1}),a.axis("val",{title:!1});var v,b=this.caculateGeom(a,t.chartType,t.attrs.subChartType);v="bubble"===t.chartType?m[0]+"*"+m[1]:"funnel"===t.chartType?c.Stat.summary.sum("metric*val"):h[0]+"*"+m[0],b.position(v),"funnel"===t.chartType?b.color("metric",["#C82B3D","#EB4456","#F9815C","#F8AB60","#EDCC72"]).label("metric",{offset:10,label:{fontSize:14}}):h.length>1&&b.color(h[1]),a.render(),this.chart=a},e.prototype.createSourceConfig=function(t,e){var r={};if(e.forEach(function(t){return r[t.id]={alias:t.name}}),i.find(e,{id:"tm"})){var a={alias:"时间",type:"time",mask:"mm-dd",nice:!0,tickCount:7};"day:8,1"===t.timeRange&&(a.tickCount=7),864e5===t.interval?a.mask="mm-dd":36e5===t.interval&&(a.mask="HH:mm"),"bar"!==t.chartType&&"vbar"!==t.chartType||(a.type="timeCat"),r.tm=a}return r},e.prototype.caculateGeom=function(t,e,r){var a;return"seperate"===r?a="dodge":"total"===r?a="stack":"percent"===r&&(a="stack"),"bar"===e?(t.coord("rect").transpose(),t.interval(a)):"vbar"===e?t.interval(a):"funnel"===e?(t.coord("rect").transpose().scale(1,-1),t.axis(!1),t.intervalSymmetric().shape("funnel")):"bubble"===e?t.point():"line"===e?t.line().size(2):t[e](a)},e}(o.Component);p.contextTypes={chartData:o.PropTypes.any},p.contextTypes={chartData:o.PropTypes.any},Object.defineProperty(e,"__esModule",{value:!0}),e.default=p},function(e,r){e.exports=t},function(t,r){t.exports=e},function(t,e){t.exports=r},function(t,e){t.exports=a}])});